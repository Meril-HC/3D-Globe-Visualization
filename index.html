<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Map with Debugging</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh; /* Fullscreen height */
      width: 100%;
    }
    .leaflet-popup-content {
      font-size: 14px;
    }
    .highlight-country {
      color: red;
      weight: 3;
      fillOpacity: 0.1;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
 <script>
  // Initialize the map
  const map = L.map('map').setView([20, 0], 2);

  // Add OpenStreetMap tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Fetch country data and GeoJSON
  fetch('./random_country_data_with_colors.json')
    .then(response => response.json())
    .then(countryData => {
      fetch('./countries.geojson')
        .then(response => response.json())
        .then(geoJsonData => {
          const countryNameMap = {
            "United States": "United States of America",
            "Russia": "Russian Federation",
            "South Korea": "Republic of Korea",
            "Iran": "Iran (Islamic Republic of)"
            // Add more mappings as needed
          };

          const geoJsonLayer = L.geoJson(geoJsonData, {
            style: feature => {
              const countryName = feature.properties.ADMIN;
              const mappedName = countryNameMap[countryName] || countryName;
              const countryInfo = countryData.find(c => c.country === mappedName);

              if (countryInfo) {
                return {
                  fillColor: countryInfo.color,
                  color: "black",
                  weight: 1,
                  fillOpacity: 0.7
                };
              } else {
                console.log(`No data for country: ${countryName}`);
                return {
                  fillColor: "grey",
                  color: "black",
                  weight: 1,
                  fillOpacity: 0.5
                };
              }
            },
            onEachFeature: (feature, layer) => {
              const countryName = feature.properties.ADMIN;
              const mappedName = countryNameMap[countryName] || countryName;
              const countryInfo = countryData.find(c => c.country === mappedName);

              if (countryInfo) {
                layer.bindPopup(`
                  <strong>${countryInfo.country}</strong><br>
                  Registered Products: ${countryInfo.registered}<br>
                  Under Registration: ${countryInfo.underRegistration}<br>
                  <img src="${countryInfo.flag}" alt="Flag" style="width: 50px; height: auto;">
                `);
              }
            }
          }).addTo(map);
        });
    })
    .catch(error => console.error('Error loading data:', error));
</script>
</body>
</html>
